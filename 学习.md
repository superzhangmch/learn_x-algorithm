### QUERY HYDRATION é˜¶æ®µ

  INPUTï¼ˆæ°´åˆå‰ï¼‰
```
  ScoredPostsQuery {
      // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
      user_id: 123456789,
      client_app_id: 258901,  // iOS/Android app identifier

      // è¯·æ±‚ä¸Šä¸‹æ–‡
      country_code: "US",
      language_code: "en",
      request_id: "abc123xyz-123456789",

      // å·²çœ‹è¿‡å’Œå·²æœåŠ¡çš„æ¨æ–‡ID
      seen_ids: vec![9001234567890, 9001234567891],
      served_ids: vec![9001234567892],

      // è¯·æ±‚å‚æ•°
      in_network_only: false,        // false = For You, true = Following
      is_bottom_request: false,      // æ˜¯å¦æ˜¯æ»šåŠ¨åˆ°åº•éƒ¨çš„è¯·æ±‚
      bloom_filter_entries: vec![],  // å»é‡ç”¨çš„å¸ƒéš†è¿‡æ»¤å™¨

      // ğŸ”´ æ°´åˆå‰è¿™ä¸¤ä¸ªå­—æ®µæ˜¯ç©ºçš„
      user_action_sequence: None,
      user_features: UserFeatures::default(),  // ç©ºçš„é»˜è®¤å€¼
  }
```

  OUTPUTï¼ˆæ°´åˆåï¼‰
```
  ScoredPostsQuery {
      // åŸºæœ¬ä¿¡æ¯ä¿æŒä¸å˜
      user_id: 123456789,
      client_app_id: 258901,
      country_code: "US",
      language_code: "en",
      request_id: "abc123xyz-123456789",
      seen_ids: vec![9001234567890, 9001234567891],
      served_ids: vec![9001234567892],
      in_network_only: false,
      is_bottom_request: false,
      bloom_filter_entries: vec![],

      // ğŸŸ¢ æ°´åˆåå¡«å……äº†ç”¨æˆ·è¡Œä¸ºåºåˆ—
      user_action_sequence: Some(UserActionSequence {
          user_id: 123456789,

          // å…ƒæ•°æ®
          metadata: Some(UserActionSequenceMeta {
              length: 50,                        // åºåˆ—ä¸­æœ‰50ä¸ªèšåˆè¡Œä¸º
              first_sequence_time: 1737360000000, // 2026-01-20 æœ€æ—©è¡Œä¸ºæ—¶é—´æˆ³
              last_sequence_time: 1737446400000,  // 2026-01-21 æœ€è¿‘è¡Œä¸ºæ—¶é—´æˆ³
              last_modified_epoch_ms: 1737446410000,
              previous_kafka_publish_epoch_ms: 1737446405000,
          }),

          // ç”¨æˆ·çš„èšåˆè¡Œä¸ºåˆ—è¡¨ï¼ˆæœ€è¿‘50ä¸ªè¡Œä¸ºï¼‰
          user_actions_data: Some(UserActionSequenceDataContainer {
              data: Some(OrderedAggregatedUserActionsList(
                  AggregatedUserActionList {
                      aggregation_provider: "DefaultAggregator",
                      aggregation_time_ms: 1737446420000,

                      // å…·ä½“çš„è¡Œä¸ºåºåˆ—ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
                      aggregated_user_actions: vec![
                          // è¡Œä¸º1: ç‚¹èµäº†ä¸€æ¡æ¨æ–‡
                          AggregatedUserAction {
                              action_type: Like,
                              tweet_id: 9001234567800,
                              author_id: 987654321,
                              impressed_time_ms: 1737360120000,  // è¡Œä¸ºå‘ç”Ÿæ—¶é—´
                              engaged_time_ms: 1737360125000,    // å®é™…ç‚¹å‡»æ—¶é—´
                              action_count: 1,
                          },

                          // è¡Œä¸º2: å›å¤äº†ä¸€æ¡æ¨æ–‡
                          AggregatedUserAction {
                              action_type: Reply,
                              tweet_id: 9001234567801,
                              author_id: 111222333,
                              impressed_time_ms: 1737360200000,
                              engaged_time_ms: 1737360245000,
                              action_count: 1,
                          },

                          // è¡Œä¸º3: è½¬å‘äº†ä¸€æ¡æ¨æ–‡
                          AggregatedUserAction {
                              action_type: Repost,
                              tweet_id: 9001234567802,
                              author_id: 444555666,
                              impressed_time_ms: 1737360300000,
                              engaged_time_ms: 1737360310000,
                              action_count: 1,
                          },

                          // è¡Œä¸º4: ç‚¹å‡»æŸ¥çœ‹äº†è¯¦æƒ…
                          AggregatedUserAction {
                              action_type: DetailExpand,
                              tweet_id: 9001234567803,
                              author_id: 777888999,
                              impressed_time_ms: 1737360400000,
                              engaged_time_ms: 1737360405000,
                              action_count: 1,
                          },

                          // è¡Œä¸º5: è®¿é—®äº†æŸä¸ªç”¨æˆ·ä¸»é¡µ
                          AggregatedUserAction {
                              action_type: ProfileVisit,
                              author_id: 123123123,
                              impressed_time_ms: 1737360500000,
                              engaged_time_ms: 1737360505000,
                              action_count: 1,
                          },

                          // ... è¿˜æœ‰45ä¸ªç±»ä¼¼çš„è¡Œä¸ºè®°å½•
                      ],
                  }
              )),
          }),

          masks: vec![
              Mask {
                  mask_type: NewEvent,
                  mask: vec![false; 50],  // 50ä¸ª falseï¼Œæ ‡è®°å“ªäº›æ˜¯æ–°äº‹ä»¶
              }
          ],
      }),

      // ğŸŸ¢ æ°´åˆåå¡«å……äº†ç”¨æˆ·ç‰¹å¾
      user_features: UserFeatures {
          // é™éŸ³çš„å…³é”®è¯åˆ—è¡¨
          muted_keywords: vec![
              "crypto".to_string(),
              "NFT".to_string(),
              "æŠ•ç¥¨".to_string(),
          ],

          // å±è”½çš„ç”¨æˆ·IDåˆ—è¡¨
          blocked_user_ids: vec![
              999888777,
              666555444,
          ],

          // é™éŸ³çš„ç”¨æˆ·IDåˆ—è¡¨
          muted_user_ids: vec![
              333222111,
          ],

          // å…³æ³¨çš„ç”¨æˆ·IDåˆ—è¡¨ï¼ˆæœ€å¤š1000ä¸ªï¼‰
          followed_user_ids: vec![
              111111111,
              222222222,
              333333333,
              444444444,
              // ... å¯èƒ½æœ‰å‡ ç™¾ä¸ª
          ],

          // è®¢é˜…çš„ç”¨æˆ·IDåˆ—è¡¨ï¼ˆTwitter Blue è®¢é˜…ï¼‰
          subscribed_user_ids: vec![
              555555555,
              666666666,
          ],
      },
  }
```
  å…³é”®å˜åŒ–æ€»ç»“
```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         å­—æ®µ         â”‚   æ°´åˆå‰   â”‚          æ°´åˆå          â”‚                   æ•°æ®æ¥æº                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ user_action_sequence â”‚ None       â”‚ åŒ…å«50ä¸ªæœ€è¿‘è¡Œä¸ºè®°å½•     â”‚ UserActionSeqQueryHydrator ä» UAS æœåŠ¡è·å–   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ user_features        â”‚ ç©ºçš„é»˜è®¤å€¼ â”‚ åŒ…å«å…³æ³¨åˆ—è¡¨ã€å±è”½åˆ—è¡¨ç­‰ â”‚ UserFeaturesQueryHydrator ä» Strato æœåŠ¡è·å– â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 ```

  è¡Œä¸ºç±»å‹ç¤ºä¾‹

  æ ¹æ®ä»£ç å¼•ç”¨ï¼Œuser_action_sequence ä¸­å¯èƒ½åŒ…å«çš„è¡Œä¸ºç±»å‹ï¼š

  - Like: ç‚¹èµ
  - Reply: å›å¤
  - Repost: è½¬å‘
  - DetailExpand: ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
  - ProfileVisit: è®¿é—®ç”¨æˆ·ä¸»é¡µ
  - VideoView: è§‚çœ‹è§†é¢‘
  - PhotoExpand: æŸ¥çœ‹å›¾ç‰‡
  - LinkClick: ç‚¹å‡»é“¾æ¥
  - Follow: å…³æ³¨
  - Block: å±è”½
  - Mute: é™éŸ³
  - Report: ä¸¾æŠ¥
  - Share: åˆ†äº«


### å¬å›é˜¶æ®µ:
```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   ç»´åº¦   â”‚             THUNDER             â”‚        PHOENIX RETRIEVAL         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ å¬å›æ–¹å¼ â”‚ åŸºäºå…³æ³¨å…³ç³»çš„ç´¢å¼•æŸ¥è¯¢          â”‚ åŸºäº embedding çš„ç›¸ä¼¼åº¦æœç´¢      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æ•°æ®ç»“æ„ â”‚ å†…å­˜ HashMapï¼ˆuser_id â†’ postsï¼‰ â”‚ Vector Indexï¼ˆANNï¼‰              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ è¾“å…¥     â”‚ followed_user_idsï¼ˆå…³æ³¨åˆ—è¡¨ï¼‰   â”‚ user_action_sequenceï¼ˆè¡Œä¸ºå†å²ï¼‰ â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ç®—æ³•     â”‚ ç›´æ¥æŸ¥è¡¨ + æ—¶é—´æ’åº             â”‚ Two-Tower + Dot Product          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ é€Ÿåº¦     â”‚ æå¿«ï¼ˆ< 1msï¼‰                   â”‚ å¿«ï¼ˆ~10msï¼‰                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ å¬å›èŒƒå›´ â”‚ In-Networkï¼ˆå…³æ³¨çš„äººï¼‰          â”‚ Out-of-Networkï¼ˆå…¨ç½‘ï¼‰           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æ–°é²œåº¦   â”‚ å®æ—¶ï¼ˆKafka æµï¼‰                â”‚ ä¾èµ– embedding æ›´æ–°é¢‘ç‡          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ å¤šæ ·æ€§   â”‚ ä½ï¼ˆåªçœ‹å…³æ³¨çš„äººï¼‰              â”‚ é«˜ï¼ˆå‘ç°æ–°å†…å®¹ï¼‰                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ä»£ç ä½ç½® â”‚ thunder_source.rs:19-73         â”‚ phoenix_source.rs:15-51          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

THUNDER è¾“å…¥è¾“å‡º
```
  è¾“å…¥ï¼š
  {
    "user_id": 123456789,
    "following_user_ids": [111, 222, 333, 444, 555]  // å…³æ³¨äº†5ä¸ªäºº
  }

  è¾“å‡ºï¼š
  {
    "posts": [
      {"tweet_id": 9001, "author_id": 111, "created_at": 1737446400, "text": "..."},
      {"tweet_id": 9002, "author_id": 222, "created_at": 1737446300, "text": "..."},
      {"tweet_id": 9003, "author_id": 333, "created_at": 1737446200, "text": "..."},
      // ... æœ€å¤šè¿”å›å‡ ç™¾æ¡æ¥è‡ªå…³æ³¨ç”¨æˆ·çš„æ¨æ–‡
    ]
  }
```
  PHOENIX RETRIEVAL è¾“å…¥è¾“å‡º
```
  è¾“å…¥ï¼š
  {
    "user_id": 123456789,
    "user_action_sequence": {
      "actions": [
        {"type": "Like", "tweet_id": 8001, "author_id": 999, "topic": "AI"},
        {"type": "Reply", "tweet_id": 8002, "author_id": 888, "topic": "Tech"},
        {"type": "Repost", "tweet_id": 8003, "author_id": 777, "topic": "ML"}
      ]
    }
  }

  è¾“å‡ºï¼š
  {
    "top_k_candidates": [
      {"tweet_id": 7001, "author_id": 666, "similarity": 0.92, "topic": "AI"},  // æœªå…³æ³¨
      {"tweet_id": 7002, "author_id": 555, "similarity": 0.89, "topic": "ML"},  // æœªå…³æ³¨
      {"tweet_id": 7003, "author_id": 444, "similarity": 0.87, "topic": "Tech"} // æœªå…³æ³¨
      // ... åŸºäºå…´è¶£ç›¸ä¼¼åº¦å¬å›çš„æ¨æ–‡
    ]
  }
```
